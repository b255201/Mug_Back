@using Mug.Dao;
@model HomePage
@{
    ViewBag.Title = "新增-首頁大圖";
}

<h1 style="color:red">新增-首頁大圖</h1>
<br /><br />
@using (Html.BeginForm("Edit", "Home", FormMethod.Post, new { @class = "form-horizontal", enctype = "multipart/form-data", id = "frmSub" }))
{
    <div class="form-group">

        <label for="Description" class="col-sm-2 control-label">標題</label>
        <div class="col-sm-10">
            @Html.EditorFor(c => c.Title, new { htmlAttributes = new { @class = "theinput form-control", placeholder = "Title" } })
        </div>
    </div>

    <div class="form-group">

        <label for="Description" class="col-sm-2 control-label">描述</label>
        <div class="col-sm-10">
            @Html.TextAreaFor(c => c.Description, new { htmlAttributes = new { @class = "theinput form-control" }, cols = "90", rows = "5" })
        </div>
    </div>
    <div class="form-group">
        <label for="file" class="col-sm-2 control-label">圖片</label>
        <div class="col-sm-3">
            @Html.EditorFor(c => c.Image, new { htmlAttributes = new { type = "file", name = "Image", @class = "form-control", onchange = "onfileChange();" } })
        </div>

    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label">預覽</label>
        <div class="col-sm-3">
            <a id="PreImgName">@ViewBag.Image</a>
            <img id="preimg" class="img-thumbnail thumb imgthumb" src="@Url.Action("GetImageFile","Home",new { fileName= Model.Image })" />
        </div>
    </div>


    <div class="form-group">
        <label for="file" class="col-sm-2 control-label">是否啟用</label>
        <div class="col-sm-3">
            @if (ViewBag.Enable == "True")
            {
                <input type="checkbox" id="Enable" name="Enable" checked />
            }
            else
            {
                <input type="checkbox" id="Enable" name="Enable" />
            }
        </div>
    </div>

    <div class="form-group">
        <div class="col-sm-2"></div>
        <div class="col-sm-3">
            <button type="button" class="btn btn-primary" onclick="onSave();">儲存</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="javascript:location.href='/Home/Index'">回查詢頁</button>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label"></label>
        <div class="col-sm-10">
            <label class=" control-label text-danger">@ViewBag.ErrMessage</label>
        </div>
    </div>
    @Html.HiddenFor(c => c.Id);
    <input hidden type="text" id="OrgImgName" name="OrgImgName" value="@ViewBag.Image">
}


@section Scripts
{
    <script>
        $(function () {

        });
        function onfileChange() {
            var filename = $('#Image').val();
            filename = filename.substring(filename.lastIndexOf('\\') + 1);
            var input = document.getElementById("Image");
            var fReader = new FileReader();
            fReader.readAsDataURL(input.files[0]);
            fReader.onloadend = function (event) {
                var img = document.getElementById("preimg");
                img.src = event.target.result;
                $("#PreImgName").text(filename);
            }
        }
        function onSave() {
            var Title = $("#Title").val();
            var Description = $("#Description").val();
            if (Title.trim() == "") {
                alert("請輸入標題");
                return false;
            }
            if (Description.trim() == "") {
                alert("請輸入描述");
                return false;
            }
            if ( $("#PreImgName").text() == "") {
                alert("請上傳圖片");
                return false;
            }
            $("#frmSub").submit();
        }

    </script>
}